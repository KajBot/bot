/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds/
 */

import org.apache.tools.ant.filters.ReplaceTokens

import java.text.SimpleDateFormat

apply plugin: 'java'
apply plugin: 'idea'
apply plugin: 'maven'

group = 'support.kajstech'
version = '2.5.7'

description = "Discord KajBot"

sourceCompatibility = 1.8
targetCompatibility = 1.8
tasks.withType(JavaCompile) {
    options.encoding = 'UTF-8'
}
task fatJar(type: Jar) {
    manifest {
        attributes 'Implementation-Title': 'Fat KajBot',
                'Implementation-Version': version,
                'Main-Class': 'support.kajstech.KajBot.KajBot'
    }
    baseName = project.name + '-with-dependencies'
    from { configurations.compile.collect { it.isDirectory() ? it : zipTree(it) } }
    with jar
}
processResources {
    filesMatching('**project.properties') {
        filter ReplaceTokens, tokens: [
                'version': version
        ]
    }
}

static def getCurrentTimestamp ()
{
    Date today = new Date ()
    SimpleDateFormat df = new SimpleDateFormat ("HH:mm:ss dd-MM-yyyy (GMT+1)")
    return df.format (today)
}

task createProperties(dependsOn: processResources) {
    doLast {
        new File("$buildDir/resources/main/app.properties").withWriter { w ->
            Properties p = new Properties()
            p['version'] = project.version.toString()
            p['buildtimestamp'] = getCurrentTimestamp().toString()
            p.store w, null
        }
    }
}

classes {
    dependsOn createProperties
}


repositories {

    maven { url "https://jitpack.io" }
    maven { url "http://jcenter.bintray.com" }
    maven { url "http://repo.maven.apache.org/maven2" }
}
dependencies {
    compile group: 'ch.qos.logback', name: 'logback-access', version:'1.3.0-alpha4'
    compile group: 'ch.qos.logback', name: 'logback-classic', version:'1.3.0-alpha4'
    compile group: 'com.mashape.unirest', name: 'unirest-java', version:'1.4.9'
    compile group: 'net.dv8tion', name: 'JDA', version:'3.5.1_348'
    compile group: 'com.sedmelluq', name: 'lavaplayer', version:'1.2.56'
    compile group: 'com.sedmelluq', name: 'jda-nas', version:'1.0.5'
    compile group: 'org.reflections', name: 'reflections', version: '0.9.10'
}
